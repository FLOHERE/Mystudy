# 마이크로 컨트롤러
## 마이크로 컨트롤러, 마이크로 컨트롤러 보드
- 마이크로 컨트롤러(MicroController) 보드 = 마이크로 컨트롤러 + a

### 칩 위의 컴퓨터
- 하나의 칩으로 구현한 컴퓨터
- 중앙 처리 장치 + 메모리 + HDD + 입출력 인터페이스
- 데스크톱 컴퓨터의 본체와 기본적으로 동일한 구조를 가짐.(+ 동일한 동작 수행)
- 전원만 주어지면 컴퓨터로 동작
- 입력장치와 출력장치를 연결 -> 컴퓨터와 같은 동작 수행

### 컴퓨터의 구성요소
![[Pasted image 20240416193122.png]]

### 마이크로 프로세서(uP)
- 컴퓨터의 중앙 처리 장치(CPU)를 하나의 칩으로 구현한 반도체 소자
- 최초의 마이크로 프로세서
	- ex_) Intel사의 4004, 1969년 발표된 4비트 마이크로 프로세서

### 마이크로 컨트롤러(uC)
- 메인보드 + 일부 HDD기능
- 싱글 칩 컴퓨터(Single Chip Computer)
- 작고 가벼운 제어장치 구성을 위해 사용되는 특화된 마이크로 프로세서의 일종

### 마이크로 프로세서/마이크로 컨트롤러 차이점
- 마이크로 프로세서
	- 메모리 : 외부 메모리 및 데이터 스토리지가 필요
	- 주변 장치 : 추가 부품이 필요
		- 외부 버스에 연결
	- 컴퓨팅 용량 : 복잡한 태스크 수행 가능
	- 클록 속도 : 아주 빠름, GHz 범위
	- 전력 소비량 : 전력 소비량 많음
		- 절전모드 없음
	- 운영체제 : 필요
	- 연결 : 고속 데이터 전송 처리
		- USB 3.0 + 기가비트 이더넷 지원
	- 요금 : 추가 구성 요소로 인해 비요이 많이 듦
	- 사용 사례 : 일반 컴퓨팅, 강력한 계산 용량 필요한 시스템
- 마이크로 컨트롤러
	- 메모리 : 온칩 메모리 모듈(ROM, RAM)
	- 주변 장치 : 온칩 주변 장치
		- ex_) 타이머, I/O 포트, 신호 변환기
	- 컴퓨팅 용량 : 특정 어플리케이션 논리로 제한
	- 클록 속도 : 빠르지만 마이크로 프로세서보다 느리다
		- KHz ~ MHz
	- 전력 소비량 : 최소한의 전력 사용
		- 내장된 절전 모드
	- 운영체제 : 선택사항
	- 연결 : 저속 및 중속
		- 직렬 주변장치 인터페이스(SPI) 및 PC 범용 비동기식 송수신기(UART)
	- 요금 : 단일 집적 회로가 여러 기능 제공
	- 사용사례 : 소형 시스템
		- 배터리 구동 or 논리 처리 디바이스 사용
#### 마이크로 컨트롤러 사용 예)
- 의료 : 의료기 제어, 자동 심박계
- 교통 : 신호등 제어, 주차장 관리
- 감시 : 출/침입자 감시
- 가전 : 에어컨, 세탁기, 전자레인지
- 음향 : CD 플레이어, 전자 타이머
- 사무 : 복사기, 무선 전화기
- 자동차 : 엔진 제어, 충돌방지

### 마이크로컨트롤러 사용의 장단점
- 단점
	- 점등 회로의 경우 하드웨어로만 구현하는 방식에 비해 장점 없음
	- 마이크로 컨트롤러 기능을 100% 사용하지 않음
	- 별도의 소프트웨어(펌웨어)를 구현
- 장점
	- 기능을 변경 또는 추가 -> 동일한 입출력 사용 -> 소프트웨어만으로 가능
	- 마이크로 컨트롤러의 가격이 지속적으로 하락 ^^
	- 소형화, 경량화, 초기 개발 시간 단축, 유지 보수 비용 절감

### 교차 개발 환경
- 교차 개발 환경
	- 프로그램 개발 -> 개발 시스템에서 진행(데탑)
	- 개발 시스템은 교차 컴파일러 사용
		- 교차 컴파일러 : 목적 시스템(마이크로 컨트롤러)에서 실행되는 기계어 파일 생성하는 곳.
	- 개발된 기계어 파일은 전용 장치 사용 -> 목적 시스템 으로 업로드

### 아두이노 프로그램의 구조
- 아두이노 = C++ 기반 -> Main 함수 필요
- 스케치 = Main 함수 없이 setup + loop 함수만으로 동작
- 아두이노는 main 함수를 숨김
	- 코딩 최소화, 직관적인 구조를 만들기 위함
- setup 함수와 loop 함수로 작성된 아두이노 스케치는 아두이노 프로그램에서 자동으로 main 함수를 추가해줌
- setup과 loop 함수가 실제로 사용되는 과정은 아두이노 프로그램이 설치된 디랙토리 내의 main.cpp에 정의

![[아두이노 스케치의 처리 흐름도.canvas]]


# 아두이노 프로그램의 구조
- 아두이노 프로그램의 기본 구조는 2개의 몸통으로 구분
	1. 실제 일을 하기 전에 준비 하는 단계
	`=> setup()`
	2. 실제 일을 하는 단계 
	`=> loop()`

## setup()
- setup() 함수는 아두이노가 시작되는 처음 단계에서 한번만 실행
- 범위 
	- void setup() : 여기서 부터 setup() 함수 시작
	- {~} : setup() 함수의 내용, 코드가 실행되는 범위
- ex_) `pinMode(13,OUTPUT);` : 아두이노의 13번 핀을 출력으로 설정

## loop
- 처음부터 끝까지 실행한 다음 다시 처음으로 돌아감(무한 반복문)
- 아두이노에 전기가 끊기기 전까지 무한 반복

## 세미콜론 ;
- 세미콜론(;)은 반드시 명령의 끝에 붙여야 한다
- 한 줄에 명령을 하나만 써야 한다는 제약은 없다
- 여러 명령을 한줄에 써도 되지만, 각 명령의 끝에 ; 을 붙여야 한다.

## 주석
- 프로그램에 대한 설명
- 형식 : /* ~ \*/ , //
- 주석은 실제로 프로그램에서 없는것으로 간주

# 스위치로 LED 켜기
## 스위치
- 제어장치
- 종류
	- 푸쉬버튼 스위치 : 아두이노 실습때 쓰는거
	- 토글 스위치
	- 등등
- 스위치(버튼)으로 LED on/off
- 푸쉬 버튼 스위치
	- 회로 구성에 있어서 기본이 되는 전자 부품
	- 모터와 같은 장치들을 On/Off 하는 용도로 많이 사용
![[Pasted image 20240416235804.png]]

## 플로팅(floating)현상
- floating : 유동적인
- 칩이 정확히 HIGH 와 LOW를 구분해내지 못하는 현상
- 주변 전기장 상태에 따라 입력값이 불안정
	=> 칩이 정확하게 전압을 인식하지 못해서 오류 발생
- 해결 방안 : 풀업 저항, 풀다운 저항
	- 10kΩ 저항을 단다

### 풀업(PULL-UP)
- 풀업 회로도의 경우 스위치를 누르지 않을 경우에 전기적인 신호 1을 보냄 -> LED on
- 스위치를 누를 경우 바로 일직선에 있는 GND로 전류가 흐름 -> LED off

![[Pasted image 20240417121221.png]]

### 풀다운(PULL-DOWN)
- 풀다운 회로도의 경우 스위치를 누르지 않을 경우에 GND에 전류가 흐르므로 전기적 신호 = 0
- 스위치를 누를 경우에 1을 나타냄  -> LED on
![[Pasted image 20240417121353.png]]

### 푸쉬버튼 스위치 : 풀업(PULL-UP)저항
- 플로팅 상태일때 값을 끌어올린다.
	- 플로팅 상태의값을 끌어 올리기 때문에 스위치가 열려있을때의 상태는 플로팅 상태(0 or 1)가 아닌 값이 1이 된다.
- 저항을 VCC단자(5V)에 달아줌 -> 플로팅 상태 방지
![[Pasted image 20240417121901.png]]


#### 1) 스위치가 열려있을때
- 스위치가 열려있기 때문에 전류는 GND가 아닌 입출력핀(ex_4번핀)으로 흐르게 됨
	  -> 입출력핀에서는 1(HIGH)값을 읽을수 있음
![[Pasted image 20240417124653.png]]

#### 2) 스위치가 닫혀있을때
- VCC와 GND가 서로 연결됨
- GND는 모든 전류가 도착하는 전압이 가장 낮은 지점
   -> 모든 전류는 GND 방향으로 흐름
- 따라서 입출력핀(4번)에 흐르는 전류가 없기 때문에 0(LOW)가 출력
![[Pasted image 20240417124842.png]]

### 푸쉬버튼 스위치 : 풀다운(PULL-DOWN)저항
- 풀업과 반대
- 플로팅 상태의 값을 다운시켜버림
- 스위치가 열려 있을때의 값은 다운되어 0이됨
- 저항이 VCC가 아닌 GND쪽에 달려있음
![[Pasted image 20240417125204.png]]

#### 1) 스위치가 열려있을때
- VCC(5V)와 회로는 단절 
   -> 입출력핀에서 흐르는 전류는 GND로 향함
- 입출력 핀에는 0(LOW)을 출력
![[Pasted image 20240417125456.png]]

#### 2) 스위치가 닫혀 있을때
- 열려 있을때 단절되었던 VCC(5V)부분이 회로와 연결됨
- 하지만 원래라면 VCC에서 흐르는 전류는 GND로 흘러야 하지만 설치된 저항으로 인해 전류는 GND로 흐르지 못하고 입출력핀으로 흐르게 됨
   -> 입출력핀에서는 1(HIGH)이 출력함
![[Pasted image 20240417125749.png]]

### 풀업 VS 풀다운
- 값이 떠있는 플로팅 상태를 방지함 -> 아두이노 스위치 사용시 필수 사항
- 풀업 > 풀다운
	- 풀업이 노이즈나 충격에 강하기 때문에 풀업을 많이 사용함
- 아두이노에서는 자체적으로 pinMode() 에서 INPUT과 OUTPUT 외에도 INTPUT_PULLUP 이라는 소프트웨어 적인 풀업모드 제공
- `pinMode(pinNum, INPPUT_PULLUP);`
	- 아두이노의 각 핀에는 내부 풀업 저항이 달려있음
	   -> 선언을 통해 자동으로 풀업을 사용 가능

- INTPUT PULLUP에 저항 사용
- 버튼을 누르지 않은 경우 HIGH(1), 누르지 않은경우 LOW(0)
```C
void setup(){
	pinMode(11, OUTPUT);
	pinMode(7, INPUT);
	Serial.begin(9600);
}
void loop(){
		int buttonstate = digitalRead(7);
		Serial.println(buttonstate);
		if(buttonstate == HIGH){
			digitalWrite(11, HIGH);
		}
	}
	else{
		digitalWrite(11, LOW);
	}
}
```

- 10kΩ 저항없이 INPUT_PULLUP 사용
```C
void setup(){
	pinMode(11, OUTPUT);
	pinMode(7, INPUT_PULLUP);
	Serial.begin(9600);
}
void loop(){
		int buttonstate = digitalRead(7);
		Serial.println(buttonstate);
		if(buttonstate == HIGH){
			digitalWrite(11, HIGH);
		}
	}
	else{
		digitalWrite(11, LOW);
	}
}
```

## 아날로그 입출력
- 아두이노(ATmega328) 마이크로 컨트롤러에는 6채널의 아날로그-디지털 변환기(Analog to Digital Converter, ADC) 가 포함되어 있으며, 이 핀들은 A0~A5까지의 아날로그 핀에 대응
- 아두이노 우노의 ADC는 10bit의 해상도를 가짐
	- 0~1023 사이의 값 반환
- 아날로그 핀의 주 용도는 외부 센서를 연결 -> 그 값을 읽어들이는 일
- 아날로그 핀은 디지털 데이터의 입출력을 위해서 사용 가능

# 피에조 부저로 소리내기
- 피에조 부저
- 피에조 부저 사용법
- 부품 목록
- 하드웨어 making
- 프로그래밍 코드

## 피에조 부저
- 피에조 효과를 이용해 소리를 내는 작은 스피커
	- 피에조 효과 : 수정이나 세라믹같은 결정체의 성질을 이용하는 것으로 압력을 주게 되면 변형이 일어남 -> 표면에 전압이 발생, 반대로 전압을 걸어주면 응축, 신장을 하는 현상을 말함. 
	  압전 효과 라고도 하는데, 여기에 얇은 판을 붙여주면 미세한 떨림으로 소리가 나게 된다.
- 큰소리를 내지 못하는 단점이 있음
- 값싸고 단순
- 주파소 2만 Hz 이상의 초음파를 발생 시킬수 있음
- ex_) 자동차 근접 경보장치 등등

### 능동 부저
- 회로가 내장되어 있어, 전원/신호만 연결해도 소리가 남
- 대신, 지정된 하나의 음만 출력

### 수동 부저
- 내장된 회로 X, 전원 연결만으로는 소리가 나지 않음
- but 음을 사용자가 커스텀 할수 있음

### 피에조 효과
- Piezo : 누른다, "Piezein" 에서 유래
	- 압력이 가해지면 전기가 발생한다는 뜻 = "압전 효과"
	- 압전 효과 : 물체에 기계적으로 압력을 가하면 전압 발생 -> 역으로 전압을 가하면 기계적인 변형이 발생
		- 압전효과를 통해 피에조 부조에서는 모듈 안쪽에 얇은 판을 사용 -> 미세한 떨림을 생성해 소리 발생
- 피에조 부저는 핀의전압을 매우 짧은 시간 안에 바꾸어 가며 주파수에 맞는 소리 낼수 있음

## 피에조 부저 사용법
- 피에조 부저는 2개의 전극 단자로 구성
	- 각 단자는 극성을 가짐
- 커버 윗면을보면 (+) 라고 써져 있거나, 옆에 조그마한 홈이 파져있는 쪽의 단자에 + 전극을 연결
- 옥타브 및 음계별 표준 주파수를 나타내는 표
- 피에조 부저에 주파수에 맞는 신호를 줌으로써 원하는 음계의 소리를 낼수 있음.
	- 주파수 : 음의 높이
		- 주파수는 1초동안 몇번의 진동을 했는지 나타내는 값

## tone(핀, 주파수 값);
- 지정한 디지털 핀에 주파수 값을 넣어주면 해당 소리가 난다.

## noTone(핀);
```C
int piezo = 7;

void setup(){
	
}
```