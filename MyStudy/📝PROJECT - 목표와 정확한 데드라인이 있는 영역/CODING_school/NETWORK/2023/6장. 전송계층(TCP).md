![[OSI참조모델_TCP,IP모델.canvas]]
## 1. 전송 계층(Transport Layer)

### 전송계층(Transport Layer)
- 네트워크 계층에서 전송한 데이터와 실제 운영체제의 프로그램이 연결되는 통신경로
- 프로토콜(TCP, UDP)과 관련된 계층으로 오류 복구와 흐름 제어 등을 담당
	- 두 시스템 간 신뢰성 있는 데이터 전송
- 네트워크 계층에서 온 데이터를 세션 계층의 어느 애플레케이션 보낼 것인지 보낼것이지 판독 
  -> 네트워크 계층으로 전송 경로 선택
- 시스템 종단 간 투명한 데이터를 양방향으로 전송하는 계층임.
	- 투명한 데이터 : 사용자가 볼수 없는 데이터

### 전송계층 데이터 단위
![[Pasted image 20231213173556.png]]

- 네트워크 계층 : 전송해야 하는 시스템에 각 패킷을 전송하는 역할
	- 전송 계층 : 해당 시스템의 응용 프로그램에 모든 데이터를 전송하는 역할을 함.
- 전송 계층의 기능
	- 연결 제어 : 패킷을 하나의 경로로 보낼 것인지 결정
	- 수신지로 데이터 전송 : 수신지에서 데이터의 모든 패킷 전송과 도착을 검사
	- 단편화 : 데이터를 전송 가능한 단편(세그먼트)으로 나누고 순서 번호를 기록함.
	- 재조립 : 수신지의 전송 계층에서 순서 번호에 따라 데이터를 올바르게 재조립함.

- TCP를 사용하는 전송 계층의 예
	- 송신 측 데이터(01001100)를 보내면 TCP의 포트번호 80번을 이용하여 수신측으로 데이터를 안전하게 전송
	- 데이터를 보내는 곳 = 전송 계층

![[Pasted image 20231213174555.png]]

- 전송 계층의 통신 방식
	- 연결형 통신(TCP) : 신뢰 O, 데이터 정확하게 전송하는 통신.
		- 신뢰성 우선, 데이터 전송할때 여러번 확인하고 전송
	- 비연결 통신(UDP) : 효율적으로 데이터 전송하는 통신
		- 통신은 효율성이 우선, 확인 절차 없이 일방적으로 데이터 전송

- TCP(연결 지향형)
	- 신뢰성 있는 바이트 스트림 서비스를 제공
	- 제어기능 수행
- 연결 지향 : 응용 프로그램이 데이터를 교환하기 전에 서로 TCP연결을 확립해야 함
	- 신뢰성이 있다 = 데이터를 성공적으로 수신 OR 오류 발생
- 연결형 서비스 : 신뢰성 있게 순차적으로 데이터 전송
	- 송신 측 전송 계층 프로세스와 수신측 전송 계층 프로세스간에 연결이라는 논리적 관계를 설정

## 2.TCP
- TCP 연결형 데이터 서비스
	- 데이터 전송 서비스 : 두 통신 프로세스간 양방향으로 동시에 데이터를 전송할수 있는 전이중 방식 서비스를 말함.
	- 전이중 방식 : 동시에 데이터 송수신 하는것.(ex_전화)
	- 연결 지향형 프로토콜 : 송신측 컴퓨터와 수신측 컴퓨터가 데이터를 전송하기 전에 먼저 데이터를 송수신 할수 있는 연결 통롤를 만들고 데이터를 전송하는 프로토콜임.
		- 신뢰성 있는 데이터 보장.
		- 오류 발생시 수신자에게 알림.

![[Pasted image 20231213181205.png]]
- 포트 번호
	- 포트는 TCP -> 상위 계층으로 데이터를 전송
	   OR 상위 계층 -> TCP로 데이터를 전송할때 상호 간 사용하는 데이터의 이동 통로를 말함.
	- 상위 계층 프로토콜 + 하위계층 프로토콜이 같은 포트를 사용해야만 통신 가능
	- 통신할때 여러 웹 사이트에서 동시에 파일 다운 가능.
		- TCP 프로토콜이 포트를 여러개 사용 -> 상위 계층의 포로그램과 각각 따로 통신.
		  파일 다운 가능

![[Pasted image 20231213182119.png]]

- 웹 브라우저로 서버에 접속 - 웹 페이지의 내용 보기
	1. 웹 브라우저에 접속하려는 IP주소 입력 - 해당 서버에 접속
	2. 서버가 웹 서비스를 위해 열어놓은 포트를 이용 - 웹 서비스를 담당하는 상위 계층의 서버 프로그램에 웹 페이지 내용 요청
	3. 웹 서비스를 하는 서버의 IP 주소가 163.152.18.73 이고, 포트 80번을 웹 서버용으로 사용하는 경우, 서버(infornet.korea.ac.kr)에 접속하려는 클라이언트도 포트 80번으로 접속해야 한다.

- 서버에 접속을 요청할때 사용하는 포트 번호 : 클라이언트의 포트 번호와 서버의 포트 번호임.
	- 서버 -> 클라이언트에 웹 페이지의 내용을 전송할때 사용하는 번호도 서버의 포트번호와 클라이언트의 포트 번호임.
	- 소스 포트 번호 : 신호를 보내는 입장에서 보낸 신호의 응답을 받을 포트 번호
	- 수신지 포트 번호 : 연결을 요청할 포트 번호
	- 포트 번호 : 0~65535번 사용 가능
	- 잘 알려진 포트 번호 : 주요 인터넷 서비스에 정해놓은 포트 번호
		- 0~1023 번 할당
- 웹 서비스
	- HTTP 프로토콜 사용  = 포트번호 80번
	- 웹 브라우저 사용 -> 웹 서버에 접속할때 포트 번호를 입력하지 않아도 자동으로 80번 할당
- 웹 페이지의 포트 번호를 80번이 아닌 다른 번호로 할당 => 해당 포트 번호를 아는 사람만 웹 페이지에 접속할수 있어 보안 유지 가능

- TCP 세그먼트
	- TCP 프로토콜은 전송을 위해 바이트 스트림을 세그먼트 단위로 나눈다.
	- 세그먼트 : TCP를 이용, 두 장치 간에 전달하는 데이터의 단위를 말함.
	- TCP 세그먼트 -> IP 데이터그램으로 캡슐화한 경우
- TCP 헤더 : TCP로 전송할때 추가하는 헤더 
- TCP 세그먼트 : TCP헤더가 붙은 데이터
![[Pasted image 20231213234903.png]]

- TCP 세그먼트의 형식과 각 필드
![[Pasted image 20231214043952.png]]

- TCP 헤더는 수신지까지 데이터를 제대로 전송하는데 필요한 정보
	- 송신지 포트 번호
		- Source Port Address필드
		- 세그먼트를 전송하는 송신지 호스트에 있는 응용 프로그램의 포트 번호
	- 수신지 포트 번호
		- Destination Port Address필드
		- 수신지 호스트에서 수행하는 프로세스가 사용하는 포트 번호
	- 순서 번호
		- Sequence Number필드
		- 세그먼트에 포함된 데이터의 첫번째 바이트에 부여됨(32 비트)
		- 0~232-1을 초과하면 0으로 되돌아온다.
		- TCP는 신뢰성 있는 연결을 보장하기 위해 전송하는 바이트 마다 번호 부여
		- 수신지 TCP에 세그먼트의 첫번째 바이트가 순서 번호에 해당하는 바이트라는것을 알려줌
		- TCP는 데이터 스트림을 일련의 세그먼트로 분할하여 전송
		- 원래의 데이터 순서대로 재조립 되어야함.
		- 이를 위해 TCP는 각 세그먼트에 순서 번호 부여
		- 순서번호는 세그먼트의 첫번째 바이트의 위치, 수신측에서는 순서번호를 통해 세그먼트의 첫세그먼트를 올바른 순서로 재조립
- TCP헤더는 수신지 까지 데이터를 제대로 전송하는데 필요한 정보
	- 확인 응답 번호
		- Acknowledgement Number 필드
		- 세그먼트를 수신하는 노드가 상대편 노드에서 수신하려는 바이트의 번호
		- 이 번호는 성공적으로 수신한 마지막 바이트의 순서 번호 +1
		- 수신측에서는 세그먼트를 받은 후 이를 확인 응답으로 응답
		- 확인 응답 번호 : 다음에 디대되는 데이터의 순서 번호 -> 이걸로 응답
			- 송신 측에게 현재까지 수신된 데이터의 범위를 알려줌
			- 재전송이나 중복 전송을 방지하는 역할
	- 헤더 길이
		- Header Length필드
		- TCP 헤더 길이를 4바이트 워드 값으로 나타냄
		- 20~60바이트의 길이(필드값 : 5 X 4 = 20 ~ 15 X 4 = 60)
		- 5~15의 값 나타내기 위해 4비트 필요
	- 예약
		- Reserved 필드
		- 6비트
		- 나중에 사용하기 위해 예약된 필드
- TCP 헤더는 수신지까지 데이터를 제대로 전송하는데 필요한 정보
	- 코드비트
		- 연결 제어 정보가 기록됨
		- TCP 헤더의 107~112번째 비트
		- 비트별로 역할 있음
		- 초깃값 0
		- 비트 활성화시 0 -> 1
		- 데이터를 전송할때 연결을 확립하려면 코드 비트중 연결 요청을 하는 SYN과 확인 응답을 하는 ACK 필요
- TCP 헤더는 수신지 까지 데이터를 제대로 전송하는데 필요한 정보
	- SYN과 ACK를 사용한 3-way 핸드셰이킹 과정
		1. 네트워크 통신을 하려면 수신 측 컴퓨터의 허락을 받아야 하므로 송신 컴퓨터는 수신측 컴퓨터에 연결 확립 허가를 받기 위한 SYN요청을 보낸다.
		2. 수신측 컴퓨터는 송신 측 컴퓨터가 보낸 요청을 받은 후 허가한다는 응답을 회신하기 위해 연결된 확립 응답인 ACK를 보낸다.
		
		   동시에 수신 측 컴퓨터는 송신 측 컴퓨터로 부터 데이터 전송 허가를 받기 위해 연결 확립요청인 SYN을 보낸다.
		   
		   이때 연결을 확립하기 위해 코드 비트의 SYN과 ACK가 1로 활성화 된다.
		3. 수신측 컴퓨터의 요청을 받은 송신측 컴퓨터는 수신 측 컴퓨터에 허가한다는 응답으로 연결 확립 응답인 ACK를 보낸다.
- TCP 헤더는 수신지 까지 데이터를 제대로 전송하는 데 필요한 정보
	- 데이터를 전송한 뒤에는 연결을 끊기 위한 요청을 교환 해야 함.
	- 연결을 끊을때는 FIN과 ACK를 사용하는데 FIN은 연결 종료를 뜻한다.
	- FIN과 ACK를 사용한 연결 종료 과정
- TCP 연결 관리
	- ![[Pasted image 20231214052104.png]]
- TCP 흐름 제어
	- TCP 패킷 번호 사용 -> 신뢰성 있는 데이터 전송
	  (패킷을 전송할때 패킷의 도착 순서가 바뀌거나 사라질수도 있기에 패킷 번호 사용)
	- 패킷을 한번에 송수신 한 후 확인 응답 신호를 전송는게 효율적
	- 윈도우 크기
		- 확인 응답을 하나하나 하지 않고 연속해서 송수신 할수 있는 데이터 크기
		- TCP 윈도우 크기 : 데이터를 전송할때 한번에 전송할수 있는 전체 패킷 크기
			- 윈도우 크기가 크면 한번에 여러 패킷 전송가능
	- 송수신측 컴퓨터가 상대방의 윈도우 크기를 확인함 -> 오버플로 방지 -> 데이터 전송

## 3.UDP
- 비연결 지향 프로토콜
- TCP와 달리 패킷이나 흐름 제어, 단편화 및 전송 보장등의 기능제공 X
- 요청 메세지와 응답 메세지만으로 구성
- 적은 양의 데이터 전송에 사용
- DNS, DHCP , SNMP 등에서 사용

- 송신지 포트 번호
	- 16비트인 송신지 포트 번호,  데이터 영역의 데이터 정보를 만든 전송 시스템의 프로세스나 응용 프로그램을 말함.
- 수신지 포트 번호
	- 16비트인 수신지 포트 번호, 데이터 영역의 데이터 정보를 처리할 수신 시스템의 프로세스나 응용 프로그램을 말함.
	- TCP 헤더의 송신지 포트와 같은 기능 수행
- 전체 길이
	- 16비트인 전체 길이는 UDP 헤더와 데이터의 길이를 바이트 단위로 표현
	- UDP 메세지에 얼마나 많은 데이터 정보가 포함 되었는지 나타냄
- 검사합
	- 수신측에서 16비트인 검사합 이용
	- UDP 헤더와 데이터 및 IP헤더의 오류 검사
	- 선택사항 -> 이영역 사용 안할시 UDP 패킷의 영역값은 0
- 데이터
	- 송신지 포트의 응용 계층 프로세스가 만든 데이터 정보로 크기가 가변적
- 신뢰성 확보를 위한 부가적인 정보 필요 X
- 전송 데이터의 양이 적을때 TCP보다 전송 속도 빠름

## 4.전송 계층 프로토콜
- TCP/IP 모델의 전송 계층에는 TCP와 UDP프로토콜이 있다.
	- TCP(Transmission Control Protocol) 전송 제어 프로토콜
		- 송신지에서 수신지 까지 문자 스트림 전송, 두 응용 계층이 서로 대화 하는것을 허용하는 신뢰성 있는 프로토콜임
		- TCP의 성능은 OSI 참조 모델의 전송 계층보다 뛰어남
	- UDP(User Datagram Protocol) 사용자 데이터그램 프로토콜
		- OSI 참조 모델에서 정의하는 전송 계층의 일부 역할을 무시하는 단순한 전송 프로토콜
		- TCP에 비해 신뢰성이 낮다.
		- 흐름 제어 및 오류 검출 등의 기능이 없어 패킷을 빠르게 전송해야 하는 경우 사용
