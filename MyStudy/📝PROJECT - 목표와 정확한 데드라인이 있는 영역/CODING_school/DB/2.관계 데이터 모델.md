# Chapter2. 관계  데이터 모델
- 학습 목표
	- 관계 데이터 모델
		- 관계 데이터 모델의 개념을 이해
		- 무결성 제약조건에 대해 이해 
			- 데이터 무결성, 도메인 무결성, 개체 무결성 , 참조 무결성
		- 관계 대수에 대해 이해 
			- 관계대수 연산자, 관계대수식

## 01. 관계 데이터 모델의 개념
- 릴레이션
- 릴레이션 스키마와 인스턴스
- 릴레이션의 특징
- 관계 데이터 모델 

### 01-1) 릴레이션의 개념
- 릴레이션(relation)
	- 행과 열로 구성된 테이블
- 용어
	- relation : 테이블(관계 아님, 테이블이라고 읽어라)
	- realational data model : 관계 데이터 모델
	- realtional database : 관게 데이터 베이스
	- relational algebra : 관계 대수
	- realtionship : 관계
- 릴레이션이란?
	- 첫번째 행: 네개의 집합중 각각 한개의 원소를 선택해서 만든것.
	- 이 원소들이 relationship을 맺음
![[Pasted image 20240407221521.png]]

- 관계(relation)
	- 릴레이션 내에서 생성되는 관계
		- 릴레이션 내 데이터들의 관계
	- 릴레이션 간에 생성되는 관계
		- 릴레이션 간의 관계
![[Pasted image 20240407224037.png]]

### 01-2) 릴레이션 [[스키마]]와 인스턴스
- 릴레이션에 사용되는 용어를 학습
	- 속성,투플, 스키마, 인스턴스
![[Pasted image 20240407224436.png]]

- 릴레이션 스키마(=내포)
	- 속성(attribute)
		- 릴레이션  스키마의 열
	- 도메인(domain)
		- 속성이 가질수 있는 값의 집합
	- 차수(degree)
		- 속성의 개수(스키마 포함)
	- 인스턴스(외연)
		- 투플의 총 집합

- 스키마의 표현
```SQL
릴레이션 이름(속성1 : 도메인1, 속성2: 도메인 2, ...)
		- 예) 도서(도서번호, 도서이름, 출판사, 가격)
		- 도서)(도서번호 : integer, 도서이름:char(40), 
					출판사 : char(40), 가격 : integer)
```

- 릴레이션(속성을 뺀 테이블 자체) 인스턴스(=외연)
	- 투플(tuple)
		- 릴레이션의 행
	- 카디날리티(cardinality) or 카디널리티
		- 투플의 수(스키마 제외)

### 01-3) 릴레이션의 특징
- 속성은 단일값을 가진다.
	- 각 속성의 값은 도메인에 정의 된 값만 기잠
	- 단일값(= 원자값) : 두개이상의 값을 가지지 않는다.
- 속성은 서로 다른 이름을 가진다.
	- 속성은 한 릴레이션에서 서로 다른 이름을 가져야함
- 한 속성의 값은 모두 같은 도메인 값을 가짐
	- 한 속성에 속한 열은 모두 그 속성에서 정의한 도메인 값만 가짐
	- 정해놓은 값만 나와야 한다는 뜻임
- 속성의 순서는 상관 없음
	- 속성의 순서가 달라도 리레이션 스키마 같음
	- ex_)(이름,주소) = (주소, 이름)
- 릴레이션 내의 중복된 투플은 허용하지 않음
	- 하나의 릴레이션 인스턴스 내에 서로 중복된 값 못가짐
	- 모든 투플은 서로 값이 달라야함
- 투플의 순서는 상관 없음

- 릴레이션의 특정에 위배되는 경우
	- 속성은 단일 값, 중복된 투플은 허용 X

![[Pasted image 20240407231405.png]]

### 01-4) 관계 데이터 모델
- 관계 데이터 모델은 데이터를 2D 테이블 형태인 릴레이션으로 표현
	- 릴레이션에 대한 제약조건과 관계 연산을 위한 관계대수를 정의함

## 02. 무결성 제약조건
- 키
- 무결성 제약조건
- 무결성 제약조건의 수행

### 02-1) 키(Key)
- 키 : 특정 투플을 식별할때 사용하는 속성(속성의 집합)
- 릴레이션 = 중복된 투플 지원 X
	- 각각의 투플에 포함된 속성중 하나이상은 값이 다름.
	- 값이 다른 속성 = 키로 설정
		- 값이 달라서 구별에 쓰이는거임
- 키는 릴레이션간의 관계를 맺는데도 사용
	- 키 = 중복되는 투플 방지

### 02-2) 슈퍼키(Super Key)
- 투플을 유일하게 식별할수 있는 하나의 속성(속성의 집합)
	- 투플을 유일하게 식별할수 있는 값 = 모두 슈퍼키
	- ex_)
		- 고객번호 : 유일값O = 수펴키O
		- 이름 : 동명이인이 있을수도? = 슈퍼키X
		- 주민번호 : 유일값 O = 슈퍼키O
		- 주소 : 가족끼리 같은 집에 살수도.. = 수퍼키X
		- 핸드폰 : 한사람이 여러대의 핸드폰 사용 or 핸드폰이 없을 수도 ? = 슈퍼키X

### 02-3) 후보키(Candidate Key)
- 투플을 유일하게 식별 할수 있는 속성의 최소 집합
	- "유일하게 식별" = "유일성"을 가진다.
	- "최소집합" = "최소성"을 가진다.
- ex_)
![[Pasted image 20240409154657.png]]
- 주문 릴레이션의 후보키 : 고객번호 + 도서번호 (2개의 속성을 합쳐 사용)
	- 고객이 같은 도서를 한번만 구입할수 있다고 가정
- 복합키(composite key)
	- 2개 이상의 속성으로 이루어진 키

### 02-4) 기본키(Primary Key)
- 여러 후보키 중 하나를 선정, 대표로 삼는 키
- 후보키가 하나뿐이라면 그 후보키를 기본키로 사용
- 후보키가 여러개 = 릴레이션의 특성을 반영, 하나 선택

- 기본키 선정시 고려사항
	- 고유한 값을 가져야 함
	- NULL 값은 허용 X
	- 키 값의 변동이 일어나지 않아야 함
	- 최대한 적은 수의 속성을가진 것이어야 함
	- 문제 소지 X 여야함
- 렐리이션 스키마를 표현  (기본키는 이텔릭 표시)
	- 릴레이션 이름(*속성1*, 속성2..속성N)
	- 고객(*고객번호*, 이름,주민번호, 주소, 핸드폰)
	- 도서(*도서번호*, 도서이름, 출판사, 가격)

### 02-5) 대리키(Surrogate Key)
- 일련번호 같은 가상의 속성을 만들어 기본키로 설정
	- 기본키가 보안을 요한 경우
	- 여러개의 속성으로 구성되어 복잡한 경우
	- 마땅한 기본키가 없는 경우
- 대리키(surrogate key) = 인조키(artificial key)
- 대리키는 DBMS나 관련 소프트웨어에서 임의로 생성하는 값으로 사용자가 직관적으로 그 값의 의미를 모름

- 기존의 주문 릴레이션 = 복합키 사용 = 복잡하다!
	- "주문번호" 라는 새로운 속성을 생성
	- 한명의 고객이 같은도서를 구입할수 있게 해줌
![[Pasted image 20240409160813.png]]

### 02-6) 대체키(Alternate key)
- 기본키로 선정되지 않은 후보키

### 02-7) 외래키(Foreign Key)
- 다른 릴레이션의 기본키를 참조하는 속성
	- 릴레이션간의 관계(relationship) 를 표현
![[Pasted image 20240409161752.png]]

- 외래키의 특징
	- 관계 데이터 모델의 릴레이션 간의 관계를 표현
	- 다른 릴레이션의 기본키 참조
	- 참조하고(외래키) 참조되는(기본키)의 양쪽 릴레이션의 도메인?은 서로 같아야 한다.
	- 참조되는(기본키) 값이 변경되면 참조하는(외래키) 값도 변경됨
		- ==참조 무결성 제약조건(외래키 제약조건): 없는 값을 참조하게 될 경우의 대안 방안==
	- Null 값과 중복 값 등 허용 : 다른 릴레이션의 값이라 상관 없음
	- 자기 자신의 기본키를 참조하는 외래키도 가능
	- 외래키가 기본키의 일부가 될수 있음

- 외래키 사용시 특이사항
	- 참조하는(or 되는) 릴레이션 = 같은 릴레이션 일수도...?
		- 자기 자신의 기본키 참조 가능
![[Pasted image 20240409164558.png]]

### 02-8) 키의 포함 관계
- 살펴본 키의 종류
	- 슈퍼키, 후보키, 기본키, 대체키
	- 대리키(인조키), 외래키

### 02-9) 무결성 제약 조건
- 데이터 무결성(Integrity)
	- 데이터베이스에 저장된 데이터의 일관성과 정확성을 지키는 것
	- {도메인, 개체, 참조} 무결성 제약 조건
- 도메인 무결성 제약조건
	- = 도메인 제약(domain constraint)
	- 투플들이 각 속성의 도메인에 지정된 값만 가져야 한다는 조건
	- SQL 문에서 지정 가능한 옵션
		- 데이터 형식(Type)
		- 널(null/note null)
		- 기본 값(default)
		- 체크(check)
- 개체 무결성 제약조건
	- = 기본키 제약(primary key constraint)
	- 릴레이션간의 참조 관계를 선언하는 제약조건
		- 자식 릴레이션의 외래키는 부모 릴레이션의 기본키와 도메인이 동일 해야함
		- 자식 릴레이션의 값이 변경될때 부모릴레이션의 제약을 받는다는것.
			- 부모가 존재해야 참조 가능

![[Pasted image 20240409165842.png]]

- +) UNIQUE 제약조건
	- = 유일성 제약조건 or 고유성 제약조건(unique constraint)
	- 속성의 모든 값은 서로 같은 값이 "없어야" 한다
		- 이는 릴레이션 내의 각각의 투플을 유일하게 식별할수 있는 속성들의 집합
		- Null값 허용

### 02-10) 무결성 제약조건의 수행
- 릴레이션은 데이터의 변경이 일어날떄 제약조건에 위배될수 있음
	- 데이터의 변경이 있을때 마다 제약조건을 지키는지 확인
		- 삽입, 수정, 삭제
	- ex_)
		- 기존의 기본키 값을 다른 투플의 기본키 값으로 변경 -> 해당 연산은 거부됨
		- 부모 릴레이션에서 투플을 삭제할 경우 자식 릴레이션은? -> 부모 릴레이션과 자식 릴레이션의 관계가 있다면(참조하는 행이 있다면) 같이 삭제됨, 관계가 없으면 오류(제약조건 위반)
- 개체 무결성 제약조건
- 참조 무결성 제약조건

### 02-11) 개체 무결성 제약조건
- 삽입
	- 기본키 값이 같거나 null 이면 삽입 금지
- 수정
	- 기본키 값이 같거나 null 로도 수정 금지됨
- 삭제
	- 특별한 확인이 필요하지 않으며 즉시 수행
	- 예외) 기본키가 외래키로 사용된 경우
- ex_)
	- 밑의 예시를 보자!
		- 남슬찬씨를 새로 등록하고 싶다! -> 이런!! 박지성씨와 학번이 겹친다 ㅠㅠ -> 삽입 거부
		- 그럼 학번없이 추가 하자! -> 이런!! 개체 무결성 제약조건에 어긋난다 ㅠㅠ -> 삽입거부
![[Pasted image 20240409222726.png]]

- ex_2)
	- (601, 박세리, 3001) 를 삽입하고 싶다 -> 부모 릴레이션(학과코드)에 3001이라는 과목 코드는 없다 -> 삽입 거부
	- 학과 릴레이션에 (3001,수학과) 를 삽입한 후, 학생을 삽입하면 가능!
![[Pasted image 20240409223008.png]]

- 부모 릴레이션의 투플이 삭제 될 경우
	- 참조하는 테이블을 같이 삭제 할수 있어서 금지시키기
	- or 다른 추가 작업 필요
- 명령어 
	- RESTRICTED : 자식 릴레이션에서 참조하고 있으면 부모 릴레이션의 삭제 작업 거부
	- CASCADE : 자식 릴레이션의 관련 투플을 같이 삭제함
	- DEFAULT : 자식 릴레이션의 관련 투플을 미리 설정해둔 값으로 변경
	- NULL : 자식릴레이션의 관련 투플을 NULL값으로 설정(NULL값을 허가한 경우)

- 수정
	- 삭제와 삽입 멸령이 연속해서 수행됨
		- 부모 리레이션의 수정이 일어남 -> 삭제 옵션에 따라 처리 -> 문제 없으면 다시 삽입 제약조건에 따라 처리
	- ex_)![[Pasted image 20240409224332.png]]

## 03. 관계대수
- 관계대수
- 셀렉션과 프로젝션
- 집합연산
- 조인
- 디비전
- 관계대수 예제

### 03-1) 관계대수
- 관계대수(Relational algebra)
	- 릴레이션에서 원하는 결과를 얻기 위해 수학의 대수와 같은 연산을 이용하여 질의하는 방법을 기술하는 언어
	- 하나 이상의 릴레이션에 연산을 수행
		- 결과 릴레이션이 나오기까지의 절차를 확인하는 방법 제공
- ==관계대수와 관계해석==
	- 관계대수
		- 어떤 데이터를 어떻게 찾는지에 대한 처리 절차를 명시하는 절차적인 언어
		- DBMS 내부의 처리 언어로 사용됨
	- 관계해석
		- 어떤 데이터를 찾는지 명시하는 선언적인 언어(=절차가 없다)
		- 관계대수와 함께 관계 DBMS의 표준 언어인 SQL의 이론적인 기반 제공
	- 관계대수와 관계해석은 모두 관계 데이터 모델의 중요한 언어, 실제로 동일한 표현 능력 가짐.

### 03-2) 관계의 수학적 의미
- 릴레이션(relation)의 수학적 개념
	- 집합 : 객체의 모임(숫자, 사람, 문자 등등)
	- 두 집합의  카티전 프로덕트 : 두 집합의 원소들로 만든 순서쌍 집합
		- ex_) A = {2,4}, B = {1,3,5} => A x B = {(2,1),(2,3),(2,5),(4,1),(4,3),(4,5)}
	- 릴레이션 R 은 카티전 프로덕트의 부분집합으로 정의 한다?????????
		- ex_) R1 = {(2,1), (4,1)} / R2={(2, 1), (2, 3), (2, 5)},
		  R3={(2, 3), (2, 5), (4, 3), (4, 5)}

- 원소 개수가 n인 집합 s 의 부분집합의 개수는 2의 n승
  => 카티전 프로덕트 A x B 의 부분집합의 개수는 2의 |A| x |B| 승

- 도메인(domain)
	- 카티전 프로덕트의 기초 집합 A,B각각이 가질수 있는 값의 범위
	- ex_) 집합A의 도메인은 {2,4}
- 릴레이션 역시 집합
	- 집합에서 가능한 연산
		- 합집합
		- 교집합
		- 카티전 프로덕트
	- ex_) R1 ∪ R2 = {(2, 1), (4, 1), (2, 3), (2, 5)} 
	  R1 ∩ R2 = {(2, 1)}

### 03-3) 릴레이션(relation)의 현실 세계 적용
![[Pasted image 20240410163633.png]]

### 03-4) 관계대수 연산자
- 연산자(Operator)
	- 피연산자(Operand)에 적용되는 연산 기호
	- ex_) 2 + 3 => 2와 3은 피연산자 , + 는 연산자
- 관계대수 연산자
	- 순수 관계연산(Relational operations)
		- 셀렉션, 프로젝션, 조인, 디비전, 개명(rename)
	- 일반 집합 연산(Set operations)
		- 합집합(union)
		- 교집합(intersection)
		- 차집합(difference or subtraction)
		- 카티전 프로덕트

### 03-5) 관계대수식
- 관계대수식(Relational algebra expression)
	- 관계대수 연산을 하기 위한 식
	- 대상이 되는 릴레이션과 연산자로 구성
	- 결과는 릴레이션으로 반환
	- 반환된 릴레이션의 모든 특징을 따름
- 단항 연산자
	- 연산자<조건> 릴레이션
- 이항 연산자
	- 릴레이션1 연산자<조건> 릴레이션2

### 03-6) 셀렉션(Selection)
- 릴레이션의 투플을 추출하기 위한 연산
	- 하나의 릴레이션을 대상으로 하는 단항 연산자
	- 투플의 조건(predicate)을 명시하고 조건에 만족하는 투플 반환
- 형식 : σ<조건> (R)
	- R : 릴레이션
	- σ : 그리스 문자, 대문자는 Σ
- ex_) 마당서점에서 판매하는 도서 중 8000원 이하의 도서를 검색하세요
	- σ 가격<=8000 (도서)
- 조건이 여러개 = 복합 조건을 통해 표현
- 형식 : σ<복합조건> (R)
	- 여러 개의 조건을 ∧(and), ∨ (or), ┑(not) 기호를 이용하여 복합조건을 표시
	- ex_) “가격이 8,000원 이하이고, 도서번호가 3 이상인 책을 찾아라”는 질의
		- σ (가격<=8000 ∧ 도서번호 >=3) (도서)

### 03-7) 프로젝션(Projection)
- 릴레이션의 속성을 추출 하기 위한 연산(원하는 속성 찾기)
	- 단항 연산자
- 형식 :  π<속성리스트> (R)
	- R : 릴레이션
	- π : 그리스 문자어, 대문자는 Π
- ex_) 신간도서 안내를 위해 (이름, 주소, 핸드폰)이 적힌 카탈로그 주소록을 만드시오
	- π이름, 주소, 핸드폰 (고객)

### 03-8) 합집합
- 두개의 릴레이션을 합하여 하나의 릴레이션 반환
	- 두개의 릴레이션 -> 서로 같은 속성 순서와 도메인을 가져야함!
- 형식 : R ∪ S

### 03-9) 교집합
- 합병가능한 두 릴레이션 대상
	- 두 릴레이션이 공통으로 가지고 있는 투플을 반환
- 형식 : R ∩ S

### 03-10) 차집합
- 첫번째 릴레이션에는 속하고 두번째에는 속하지 않는 투플 반환
- 형식 : R - S
- ex_)마당 서점 두 지점중 지점 A만 보유하고 있는 도서 목록을 보이시오
	- 도서 A - 도서 B

### 03-11) 카티전 프로덕트(Catesian product)
- 두 릴레이션을 연결시켜 하나로 합칠때 사용
	- 결과 릴레이션 : 첫번째 릴레이션의 오른쪽에 두번째 릴레이션의 모든 투플을 순서대로 배열하여 반환(순서쌍 만들기)
	- 결과 릴레이션의 차수 = 두릴레이션 차수의 합
	- 카디날리티(투플의 수)는 두 릴레이션의 카디날리티의 곱
- 형식 : R x S

### 03-12) 조인(join)
- 두 릴레이션의 공통 속성을 기준으로 속성 값이 같은 투플을 수평으로 결합하는 연산
	- 조인을 수행하기 위해서는 두 릴레이션의 조인에 참여하는 속성이 서로 동일한 도메인으로 구성 되어야함
	- 조인의 연산의 결과는 공통 속성 값이 동일한 투플만을 반환
- 형식 : R ⋈c S = σc(R x S)
	- R과 S는 릴레이션, c는 조인조건
- 조인 연산의 구분
	- 기본 연산 
		- 세타조인(⋈θ)
		- 동등조인(⋈)
		- 자연조인(⋈N)
	- 확장된 조인 연산
		- 세미조인(⋉)
		- 외부조인(⟕,​⟖,⟗)

#### 03-12-1) 세타조인과 동등조인
- 세타조인(theta join,⋈θ)
	- 두 릴레이션의 속성값을 비교하여 조건을 만족하는 투플만 반환함
	- 세타조인의 조건
		- =, ≠, ≤, ≥, ＜, ＞
	- 형식 : R ⋈(r 조건 s) S
		- R과 S는 릴레이션, r은 R의 속성, s는 S의 속성
- 동등조인(equi join)
	- 세타조인에서 = 연산자를 사용한 조인 말함
	- 보통 조인 연산 = 동등조인
	- 형식 : R ⋈(r = s) S
- inner join = euai join

#### 03-12-2) 자연조인(Natural join)
- 동등조인에서 조인에 참여한 속성이 두번 나오지 않도록 두번째 속성을 제거한 결과를 반환함
	  (중복 제거한 후 나온애들)
- 형식 :  R ⋈n(r,s) S

#### 03-12-3) 외부조인 (outer join)
- 외부조인(outer join)
	- 자연 조인시, 조인에 "실패한" 투플을 모두 보여줌 , but 값이 없는 대응 속성에는 NULL 값을 채워 반환
	- 모든 속성을 보여주는 기준 릴레이션 위치의 종류
		- R ⟕ (r, s) S : 왼쪽(left) 외부 조인
		- R ​⟖ (r, s)S : 오른쪽(right)외부 조인
		- R ⟗(r, s)S : 완전(full)외부 조인

#### 03-12-4) 세미조인 (semijoin)
- 자연조인 후 "한쪽 릴레이션의 결과만" 반환
	- 닫힌쪽 릴레이션의 투플만 반환
- 형식 : R ⟖ (r, s) S

### 03-13) 디비전(Division)
- 릴레이션의 속성 값의 집합으로 연산 수행
	- 특정값들을 모두 가진 투플을 찾을때 사용
- 형식 : R ÷ S